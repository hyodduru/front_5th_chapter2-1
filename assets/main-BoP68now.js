import"./modulepreload-polyfill-B5Qt9EMX.js";const f={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25},r=.25,C=.05,x=.2,p=.1,h=30,g=2,T=1e3,S=5,E=3e4,I=6e4,q=[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],o={products:[],productDropdown:null,addToCartButton:null,cartList:null,cartTotalPrice:null,stockStatusMessage:null,lastSelectedProductId:null,bonusPoints:0,totalAmount:0,itemCount:0};function d(){const{productDropdown:e,products:t}=o;e.innerHTML="",t.forEach(a=>{const n=document.createElement("option");n.value=a.id,n.textContent=`${a.name} - ${a.price}원`,a.quantity===0&&(n.disabled=!0),e.appendChild(n)})}function D(){const{cartTotalPrice:e}=o;o.bonusPoints=Math.floor(o.totalAmount/T);let t=document.getElementById("loyalty-points");t||(t=document.createElement("span"),t.id="loyalty-points",t.className="text-blue-500 ml-2",e.appendChild(t)),t.textContent=`(포인트: ${o.bonusPoints})`}function L(){const{stockStatusMessage:e,products:t}=o,a=t.filter(n=>n.quantity<S).map(n=>`${n.name}: ${n.quantity>0?`재고 부족 (${n.quantity}개 남음)`:"품절"}`).join(`
`);e.textContent=a}function M(e,t){const{cartTotalPrice:a}=o;if(a.textContent=`총액: ${Math.round(e)}원`,t>0){const n=document.createElement("span");n.className="text-green-500 ml-2",n.textContent=`(${(t*100).toFixed(1)}% 할인 적용)`,a.appendChild(n)}}function N(e,t,a){let n=0;if(a>=h){const s=e*r,c=e-t;s>c?(t=e*(1-r),n=r):n=c/e}else n=(e-t)/e;return new Date().getDay()===g&&(t*=1-p,n=Math.max(n,p)),o.totalAmount=t,n}function b(e){let t=0,a=0,n=0;return[...e].forEach(s=>{const c=parseInt(s.querySelector("span").textContent.split("x ")[1]),i=o.products.find(y=>y.id===s.id);if(!i)return;const l=i.price*c,m=c>=10&&f[i.id]||0;t+=c,n+=l,a+=l*(1-m)}),{subTotal:n,itemCount:t,totalAmount:a}}function u(){const e=o.cartList.children,{subTotal:t,itemCount:a,totalAmount:n}=b(e);o.itemCount=a,o.totalAmount=n;const s=N(t,n,a);M(o.totalAmount,s),L(),D()}function w(){const{productDropdown:e,products:t}=o,a=e.value,n=t.find(s=>s.id===a);if(n&&n.quantity>0){const s=document.getElementById(n.id);if(s){const c=parseInt(s.querySelector("span").textContent.split("x ")[1])+1;c<=n.quantity?(s.querySelector("span").textContent=`${n.name} - ${n.price}원 x ${c}`,n.quantity--):alert("재고가 부족합니다.")}else{const c=document.createElement("div");c.id=n.id,c.className="flex justify-between items-center mb-2",c.innerHTML=`<span>${n.name} - ${n.price}원 x 1</span>
        <div>
          <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${n.id}" data-change="-1">-</button>
          <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${n.id}" data-change="1">+</button>
          <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${n.id}">삭제</button>
        </div>`,o.cartList.appendChild(c),n.quantity--}u(),o.lastSelectedProductId=a}}function v(e,t,a){const n=parseInt(e.dataset.change),s=parseInt(t.querySelector("span").textContent.split("x ")[1]),c=s+n;c>0&&c<=a.quantity+s?(t.querySelector("span").textContent=t.querySelector("span").textContent.split("x ")[0]+"x "+c,a.quantity-=n):c<=0?(t.remove(),a.quantity-=n):alert("재고가 부족합니다.")}function P(e,t){const a=parseInt(e.querySelector("span").textContent.split("x ")[1]);t.quantity+=a,e.remove()}function A(e){const t=e.target;if(!t.classList.contains("quantity-change")&&!t.classList.contains("remove-item"))return;const a=t.dataset.productId,n=document.getElementById(a),s=o.products.find(c=>c.id===a);!s||!n||(t.classList.contains("quantity-change")?v(t,n,s):t.classList.contains("remove-item")&&P(n,s),u())}function _(){const e={container:document.createElement("div"),productWrapper:document.createElement("div"),heading:document.createElement("h1"),cartList:document.createElement("div"),cartTotalPrice:document.createElement("div"),productDropdown:document.createElement("select"),addToCartButton:document.createElement("button"),stockStatusMessage:document.createElement("div")};return e.cartList.id="cart-items",e.cartTotalPrice.id="cart-total",e.productDropdown.id="product-select",e.addToCartButton.id="add-to-cart",e.stockStatusMessage.id="stock-status",e.container.className="bg-gray-100 p-8",e.productWrapper.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",e.heading.className="text-2xl font-bold mb-4",e.cartTotalPrice.className="text-xl font-bold my-4",e.productDropdown.className="border rounded p-2 mr-2",e.addToCartButton.className="bg-blue-500 text-white px-4 py-2 rounded",e.stockStatusMessage.className="text-sm text-gray-500 mt-2",e.heading.textContent="장바구니",e.addToCartButton.textContent="추가",e}function $(e){setTimeout(()=>{setInterval(()=>{const t=e[Math.floor(Math.random()*e.length)];Math.random()<.3&&t.quantity>0&&(t.price=Math.round(t.price*(1-x)),alert(`번개세일! ${t.name}이(가) 20% 할인 중입니다!`),d())},E)},Math.random()*1e4)}function O(e){setTimeout(()=>{setInterval(()=>{if(o.lastSelectedProductId){const t=e.find(a=>a.id!==o.lastSelectedProductId&&a.quantity>0);t&&(alert(`${t.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`),t.price=Math.round(t.price*(1-C)),d())}},I)},Math.random()*2e4)}function B({addToCartButton:e,cartList:t}){e.addEventListener("click",w),t.addEventListener("click",A)}function k(){o.products=q;const e=document.getElementById("app"),t=_();o.cartList=t.cartList,o.cartTotalPrice=t.cartTotalPrice,o.productDropdown=t.productDropdown,o.addToCartButton=t.addToCartButton,o.stockStatusMessage=t.stockStatusMessage,d(),t.productWrapper.append(t.heading,o.cartList,o.cartTotalPrice,o.productDropdown,o.addToCartButton,o.stockStatusMessage),t.container.appendChild(t.productWrapper),e.appendChild(t.container),u(),B(t),$(o.products),O(o.products)}k();
